import React, { useState, useEffect, useCallback } from "react";

const POSITIONS = [
  { id: "centered", css: "top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" },
  { id: "top-left", css: "top-24 left-10" },
  { id: "top-right", css: "top-24 right-10" },
  { id: "bottom-left", css: "bottom-40 left-10" },
  { id: "bottom-right", css: "bottom-40 right-10" },
];

const BalloonGame = () => {
  const [level, setLevel] = useState(1);
  const [gameStatus, setGameStatus] = useState<
    "start" | "playing" | "success" | "failure"
  >("start");
  const [score, setScore] = useState(0);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [showBalloon, setShowBalloon] = useState(true);
  const [timeLeft, setTimeLeft] = useState(0);
  const [serverData, setServerData] = useState<any>(null);

  const getLevelConfig = (lvl: number) => {
    switch (lvl) {
      case 1:
        return { totalSteps: 10, balloonDuration: 3000, timeLimit: 0 };
      case 2:
        return { totalSteps: 15, balloonDuration: 2000, timeLimit: 45 };
      case 3:
        return { totalSteps: 20, balloonDuration: 1500, timeLimit: 60 };
      default:
        return { totalSteps: 10, balloonDuration: 3000, timeLimit: 0 };
    }
  };

  const config = getLevelConfig(level);

  const saveAndCheckResult = async (finalScore: number) => {
    try {
      const response = await fetch("http://localhost:5067/api/scores/save", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          score: finalScore,
          total: config.totalSteps,
          level: level,
        }),
      });
      const result = await response.json();

      if (result.success) {
        setServerData(result.data);
        if (result.data.percentage >= 80) {
          setGameStatus("success");
        } else {
          setGameStatus("failure");
        }
      }
    } catch (e) {
      const localPct = (finalScore / config.totalSteps) * 100;
      setGameStatus(localPct >= 80 ? "success" : "failure");
    }
  };

  const nextStep = useCallback(() => {
    if (currentIndex < config.totalSteps - 1) {
      setCurrentIndex((prev) => prev + 1);
      setShowBalloon(true);
    } else {
      setShowBalloon(false);
      saveAndCheckResult(score);
    }
  }, [currentIndex, score, config.totalSteps]);

  useEffect(() => {
    let balloonTimer: NodeJS.Timeout;
    if (gameStatus === "playing" && showBalloon) {
      balloonTimer = setTimeout(() => {
        setShowBalloon(false);
        nextStep();
      }, config.balloonDuration);
    }
    return () => clearTimeout(balloonTimer);
  }, [showBalloon, gameStatus, config.balloonDuration, nextStep]);

  useEffect(() => {
    let levelInterval: NodeJS.Timeout;
    if (gameStatus === "playing" && config.timeLimit > 0) {
      setTimeLeft(config.timeLimit);
      levelInterval = setInterval(() => {
        setTimeLeft((prev) => {
          if (prev <= 1) {
            clearInterval(levelInterval);
            saveAndCheckResult(score);
            return 0;
          }
          return prev - 1;
        });
      }, 1000);
    }
    return () => clearInterval(levelInterval);
  }, [gameStatus, level, config.timeLimit]);

  const handleBalloonClick = () => {
    setScore((prev) => prev + 1);
    setShowBalloon(false);
    nextStep();
  };

  const handleNextLevel = () => {
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ØªØ®Ø·ÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3
    if (level < 3) {
      setLevel(level + 1);
      setScore(0);
      setCurrentIndex(0);
      setServerData(null);
      setGameStatus("playing");
      setShowBalloon(true);
    }
  };

  const handleRetry = () => {
    setScore(0);
    setCurrentIndex(0);
    setServerData(null);
    setGameStatus("playing");
    setShowBalloon(true);
  };

  if (gameStatus === "success" || gameStatus === "failure") {
    return (
      <ResultScreen
        type={gameStatus}
        score={score}
        total={config.totalSteps}
        percentage={serverData?.percentage}
        onNext={handleNextLevel}
        onRetry={handleRetry}
        currentLevel={level}
      />
    );
  }

  return (
    <div className="relative w-full h-screen bg-[#E3F2FD] overflow-hidden">
      <div className="absolute top-0 w-full p-6 flex items-center justify-between z-10">
        <div className="bg-white/80 px-4 py-2 rounded-2xl shadow-sm font-bold text-blue-900">
          Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {level}
        </div>
        <div className="w-1/3 h-3 bg-white rounded-full border border-blue-100 overflow-hidden shadow-inner">
          <div
            className="h-full bg-blue-400 transition-all duration-500"
            style={{ width: `${(currentIndex / config.totalSteps) * 100}%` }}
          ></div>
        </div>
        {config.timeLimit > 0 && (
          <div className="bg-red-50 text-red-600 px-4 py-2 rounded-2xl font-bold border border-red-100 shadow-sm animate-pulse">
            â± {timeLeft}s
          </div>
        )}
        <div className="font-bold text-blue-900 font-arabic text-lg">
          â­ 50ro
        </div>
      </div>

      {gameStatus === "start" ? (
        <div className="flex h-full items-center justify-center">
          <button
            onClick={() => setGameStatus("playing")}
            className="bg-blue-600 text-white px-20 py-5 rounded-[30px] text-3xl font-black shadow-[0_8px_0_0_#1e3a8a] active:translate-y-1 transition-all"
          >
            Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨
          </button>
        </div>
      ) : (
        showBalloon && (
          <div
            className={`absolute transition-all duration-300 cursor-pointer ${
              POSITIONS[currentIndex % POSITIONS.length].css
            }`}
            onClick={handleBalloonClick}
          >
            <div className="relative animate-bounce">
              <svg
                width="80"
                height="174"
                viewBox="0 0 80 174"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M40.3757 173.556C40.1252 173.556 39.8928 173.404 39.8223 173.266C39.8028 173.229 39.7668 173.158 39.8883 172.992C45.1443 165.708 43.2182 158.125 41.3567 150.792C39.8747 144.954 38.3417 138.916 40.4387 133.008C40.9487 131.571 41.7168 130.242 42.5283 128.835C43.6203 126.942 44.7483 124.984 45.2178 122.721C46.2558 117.714 44.6073 113.086 42.6753 108.394C39.8778 101.602 38.0553 95.9144 42.0393 89.7194C42.1398 89.5634 42.2553 89.4944 42.4143 89.4944C42.6228 89.4944 42.8553 89.6234 42.9468 89.7899C42.9738 89.8379 43.0277 89.9369 42.9002 90.1349C38.7872 96.5264 41.2413 102.421 43.6143 108.123C45.0573 111.592 46.5498 115.179 46.5468 118.861C46.5438 122.428 45.0678 125.29 43.5063 128.32C42.2373 130.782 40.9248 133.329 40.4328 136.309C39.5088 141.895 40.8963 147.109 42.2388 152.152C44.1573 159.363 45.9693 166.173 40.8048 173.331C40.6878 173.485 40.5527 173.556 40.3757 173.556Z"
                  fill="#080808"
                />
                <path
                  d="M39.5798 91.584C39.5798 91.584 29.1518 98.2785 30.3938 100.625C31.6358 102.971 36.6023 98.5545 37.2923 100.625C37.9823 102.695 38.9483 103.109 40.1888 102.971C41.4308 102.833 41.0168 99.522 43.3628 100.487C45.7088 101.453 50.6753 102.419 49.2953 99.3825C47.9153 96.3465 43.5233 91.788 39.5798 91.584Z"
                  fill="#1A71FF"
                />
                <path
                  d="M39.5794 0C25.8469 0 0.150441 14.2905 0.000440748 53.814C-0.152559 93.8835 39.5794 97.167 39.5794 97.167C39.5794 97.167 79.3114 93.882 79.1584 53.814C79.0069 14.2905 53.3119 0 39.5794 0Z"
                  fill="#488DFF"
                />
                <path
                  d="M42.1996 0.162018C53.8442 7.35902 65.2066 22.4685 65.3056 48.7095C65.4586 88.779 25.7266 92.0625 25.7266 92.0625C25.7266 92.0625 23.9386 91.911 21.1396 91.3005C30.5641 96.411 39.5791 97.1655 39.5791 97.1655C39.5791 97.1655 79.3111 93.8805 79.1581 53.8125C79.0172 16.6845 56.3326 1.82552 42.1996 0.162018Z"
                  fill="#1A71FF"
                />
                <path
                  d="M25.7194 10.02C18.0919 14.3145 11.9959 22.929 9.79238 31.281C9.19988 33.528 12.6709 34.479 13.2619 32.238C15.2359 24.759 20.6929 16.98 27.5359 13.128C29.5579 11.9895 27.7444 8.88002 25.7194 10.02Z"
                  fill="#FFFDF7"
                />
                <path
                  d="M8.0109 39.591C7.6734 40.332 7.4784 41.031 7.4529 41.8515C7.4229 42.8325 8.2944 43.6515 9.2529 43.6515C10.2564 43.6515 11.0229 42.8325 11.0529 41.8515C11.0679 41.3355 10.9599 42.204 11.0664 41.6535C11.0709 41.631 11.2599 41.1 11.1189 41.4075C11.5254 40.515 11.3829 39.4785 10.4739 38.946C9.6924 38.4885 8.4174 38.6985 8.0109 39.591Z"
                  fill="#FFFDF7"
                />
              </svg>
            </div>
          </div>
        )
      )}
      <div className="absolute bottom-[-43px] w-full h-50   pointer-events-none">
        <svg
          width="100%"
          height="100%"
          viewBox="0 0 327 85"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M308.346 46.1915C299.409 39.2075 288.067 33.6896 276.983 31.3616C271.054 30.1543 264.609 30.6719 258.508 30.4997C253.782 30.4131 248.713 31.6204 244.073 32.6556C242.784 32.9143 241.065 32.8277 239.948 33.4319C239.777 33.5185 237.457 35.3289 237.113 34.6392C236.683 33.7773 237.371 32.0524 236.855 31.0173C234.879 27.2232 227.746 27.1377 224.481 28.8615C222.935 29.6378 221.302 31.3616 219.841 32.3968C219.583 32.5689 218.553 34.5526 218.466 34.466C218.037 34.035 218.81 28.6893 218.81 27.8263C218.466 23.6879 216.576 18.8587 214.256 15.41C211.764 11.7025 207.725 9.80549 203.944 7.90845C192.602 2.13177 183.236 -2.0933 170.09 1.0966C155.396 4.6319 139.156 19.635 131.337 32.3957C128.931 36.3619 127.556 41.1045 126.096 45.5873C125.925 46.1049 125.237 49.5535 124.808 49.8123C124.378 50.0711 124.636 48.7772 124.55 48.3463C124.378 47.2256 124.378 46.1049 124.206 45.0697C123.948 43.2593 121.972 40.5004 120.081 40.2416C116.902 39.8106 112.95 42.052 111.575 44.9842C111.231 45.6739 110.801 49.1226 110.2 49.468C109.771 49.7268 109.685 48.6061 109.513 48.1752C108.482 45.2441 108.997 41.5355 107.537 38.691C104.53 32.8277 97.3982 30.6719 91.2109 32.138C82.4467 34.2938 77.6341 50.331 74.4551 57.315C74.1972 57.9181 73.9393 64.0402 73.6814 64.1268C73.1656 64.3856 72.9941 63.2649 72.7362 62.7473C71.533 60.4193 69.2993 55.5045 66.9793 54.2117C65.6909 53.5219 65.433 54.0395 64.6593 54.9014C63.4562 56.2809 61.9951 57.6604 61.7383 59.644C61.652 60.5059 62.5973 62.4896 62.4257 63.0927C62.2541 63.6103 61.7383 62.2308 61.4804 61.7133C60.8783 60.5059 60.7931 59.7307 60.3636 58.5234C59.3331 55.851 56.411 50.1599 52.5446 50.763C50.311 51.1084 50.3962 56.7985 50.5678 58.2646C50.5678 58.7821 50.6541 59.9894 50.912 60.5059C50.9983 60.7647 51.6857 61.109 51.4278 61.0235C46.4447 59.4719 41.2025 57.1439 36.0468 56.1954C30.8057 55.1613 24.7899 58.61 20.4942 60.8514C10.9787 65.857 2.10046 74.1713 0 85.2263H326.495C327.823 82.8021 326.219 77.852 325.276 75.5957C321.149 65.5052 317.283 53.1755 308.346 46.1915Z"
            fill="#0E895C"
            fill-opacity="0.7"
          />
          <path
            d="M167.488 30.551C167.573 30.4237 167.277 30.8472 167.193 30.9744C167.025 31.2706 166.857 31.5669 166.73 31.8203C166.224 32.8351 165.76 33.851 165.633 34.9931C165.422 36.9393 166.989 38.5498 168.908 38.6888C172.652 38.9604 173.516 36.6003 173.263 34.1044C173.137 33.0468 172.546 32.201 172.167 31.2279C172.167 31.1862 172.04 30.9317 172.124 30.89C172.335 30.7627 173.347 31.6513 173.515 31.7358C174.358 32.201 175.539 32.4127 176.466 32.201C180.007 31.4824 181.234 27.4049 178.334 24.431C176.472 22.5212 173.768 24.3754 172.123 26.0254C171.996 26.1527 172.25 25.6875 172.334 25.5175C172.418 25.2641 172.545 25.0095 172.671 24.7561C173.093 23.9102 173.261 22.9799 173.134 22.0068C172.839 19.7643 170.485 17.8898 167.632 18.9677C165.727 19.6873 164.703 22.1758 165.588 24.2065C165.968 25.0951 166.136 25.8565 166.726 26.6179C166.769 26.6607 167.022 26.9986 167.063 26.9558C167.106 26.913 166.852 26.7024 166.811 26.6596C166.095 25.9399 165.42 25.3485 164.45 24.8834C162.595 23.953 160.234 24.9026 159.433 26.4682C158.422 28.4561 158.844 31.6096 160.782 33.0052C161.33 33.3858 161.92 33.851 162.637 33.7238C164.664 33.4276 166.35 32.0737 167.488 30.551Z"
            fill="#F9F5CF"
            fill-opacity="0.7"
          />
          <path
            d="M171.865 28.6817C171.865 30.0313 170.775 31.1263 169.429 31.1263C168.084 31.1263 166.993 30.0323 166.993 28.6817C166.993 27.3322 168.083 26.2372 169.429 26.2372C170.774 26.2372 171.865 27.3311 171.865 28.6817Z"
            fill="#F47D3A"
            fill-opacity="0.7"
          />
          <path
            d="M238.495 65.566C238.607 65.3981 238.216 65.9585 238.104 66.1264C237.881 66.5188 237.658 66.9113 237.489 67.2471C236.819 68.5923 236.205 69.9376 236.037 71.4507C235.758 74.0289 237.834 76.1634 240.376 76.3473C245.337 76.7077 246.483 73.5809 246.147 70.2733C245.98 68.8725 245.198 67.7507 244.695 66.4621C244.695 66.4065 244.527 66.0697 244.639 66.0141C244.918 65.8462 246.259 67.0236 246.483 67.1348C247.6 67.7518 249.164 68.032 250.393 67.7518C255.085 66.799 256.71 61.3977 252.868 57.456C250.401 54.9248 246.817 57.3822 244.639 59.5691C244.472 59.737 244.806 59.121 244.918 58.8964C245.03 58.5607 245.198 58.2238 245.365 57.888C245.923 56.7673 246.147 55.5344 245.98 54.2447C245.589 51.274 242.469 48.7899 238.689 50.2175C236.165 51.1714 234.808 54.4682 235.982 57.1587C236.485 58.3361 236.707 59.3445 237.489 60.354C237.545 60.4096 237.881 60.8587 237.936 60.802C237.991 60.7453 237.657 60.4662 237.6 60.4096C236.651 59.4568 235.757 58.6719 234.473 58.0559C232.015 56.8229 228.886 58.0816 227.825 60.1551C226.484 62.79 227.044 66.9679 229.613 68.8169C230.339 69.3216 231.121 69.9376 232.07 69.7697C234.753 69.3772 236.988 67.5828 238.495 65.566Z"
            fill="#F9F5CF"
            fill-opacity="0.7"
          />
          <path
            d="M241.067 66.3274C242.85 66.3274 244.295 64.8772 244.295 63.0883C244.295 61.2994 242.85 59.8492 241.067 59.8492C239.284 59.8492 237.839 61.2994 237.839 63.0883C237.839 64.8772 239.284 66.3274 241.067 66.3274Z"
            fill="#F47D3A"
            fill-opacity="0.7"
          />
          <path
            d="M117.553 82.1905C117.665 82.0226 117.274 82.5829 117.162 82.7508C116.938 83.1433 116.715 83.5357 116.547 83.8715C115.877 85.2168 115.262 86.562 115.095 88.0752C114.815 90.6534 116.891 92.7878 119.434 92.9718C124.395 93.3311 125.54 90.2053 125.205 86.8978C125.037 85.497 124.255 84.3752 123.752 83.0866C123.752 83.031 123.585 82.6942 123.697 82.6386C123.976 82.4707 125.317 83.647 125.54 83.7593C126.657 84.3763 128.222 84.6564 129.45 84.3763C134.143 83.4235 135.768 78.0221 131.926 74.0805C129.459 71.5493 125.875 74.0067 123.697 76.1935C123.529 76.3614 123.864 75.7455 123.976 75.5209C124.088 75.1851 124.255 74.8483 124.423 74.5125C124.981 73.3918 125.205 72.1578 125.037 70.8692C124.646 67.8985 121.527 65.4144 117.747 66.842C115.222 67.7959 113.866 71.0927 115.039 73.7832C115.542 74.9606 115.765 75.969 116.547 76.9784C116.603 77.034 116.938 77.4832 116.994 77.4265C117.049 77.3709 116.714 77.0907 116.658 77.0341C115.708 76.0813 114.814 75.2963 113.53 74.6793C111.073 73.4464 107.944 74.705 106.882 76.7795C105.542 79.4144 106.101 83.5924 108.671 85.4414C109.396 85.9461 110.179 86.562 111.128 86.3941C113.81 86.0017 116.044 84.2084 117.553 82.1905Z"
            fill="#F9F5CF"
            fill-opacity="0.7"
          />
          <path
            d="M120.123 82.9519C121.906 82.9519 123.351 81.5017 123.351 79.7128C123.351 77.9239 121.906 76.4737 120.123 76.4737C118.341 76.4737 116.896 77.9239 116.896 79.7128C116.896 81.5017 118.341 82.9519 120.123 82.9519Z"
            fill="#F47D3A"
            fill-opacity="0.7"
          />
        </svg>
      </div>
    </div>
  );
};

const ResultScreen = ({
  type,
  score,
  total,
  percentage,
  onNext,
  onRetry,
  currentLevel,
}: any) => {
  const displayPercentage = percentage ?? Math.round((score / total) * 100);

  return (
    <div className="h-screen bg-white flex flex-col items-center justify-center p-8 text-center">
      <h3 className="text-gray-400 font-bold mb-2 italic">
        Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ {currentLevel}
      </h3>
      <div className="text-8xl font-black text-blue-600 mb-6">
        {displayPercentage}%
      </div>

      <h2
        className={`text-5xl font-black mb-20 ${
          type === "success" ? "text-blue-900" : "text-red-600"
        }`}
      >
        {type === "success" ? "Ø£Ø­Ø³Ù†Øª Ø¨Ø·Ù„!" : "Ø­Ø§ÙˆÙ„ ØªØ§Ù†ÙŠ"}
      </h2>

      <div className="w-56 h-72 bg-blue-50 rounded-[40px] flex items-center justify-center mb-10  border-4 border-white">
        <span className="text-[120px] ">
          {type === "success" ? (
            <svg
              width="240"
              height="386"
              viewBox="0 0 240 386"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect
                x="137.5"
                y="305.5"
                width="25"
                height="50"
                fill="#FFDAB9"
                stroke="#EEC9A9"
              />
              <rect x="137" y="348" width="26" height="16" fill="#797979" />
              <path
                d="M162 364.15C169.097 364.15 174.85 369.903 174.85 377V384C174.85 385.022 174.022 385.85 173 385.85H139C137.978 385.85 137.15 385.022 137.15 384V364.15H162Z"
                fill="#3D4144"
                stroke="#050003"
                stroke-width="0.3"
              />
              <rect
                x="-0.5"
                y="0.5"
                width="25"
                height="50"
                transform="matrix(-1 0 0 1 105 305)"
                fill="#FFDAB9"
                stroke="#EEC9A9"
              />
              <rect
                width="26"
                height="16"
                transform="matrix(-1 0 0 1 106 348)"
                fill="#797979"
              />
              <path
                d="M81 364.15C73.9031 364.15 68.1504 369.903 68.1504 377V384C68.1504 385.022 68.9783 385.85 70 385.85H104C105.022 385.85 105.85 385.022 105.85 384V364.15H81Z"
                fill="#3D4144"
                stroke="#050003"
                stroke-width="0.3"
              />
              <path
                d="M128.5 292.5C123.7 293.7 116.833 293 114 292.5V315.5H70.5V267H171V315.5H128.5V292.5Z"
                fill="#3D3F44"
                stroke="#050003"
                stroke-width="0.3"
              />
              <path
                d="M15.668 95.548C15.668 77.5722 30.2402 63 48.2159 63H189.08C207.056 63 221.628 77.5722 221.628 95.548V135.87C221.628 153.46 207.368 167.72 189.778 167.72H47.5178C29.9276 167.72 15.668 153.46 15.668 135.87V95.548Z"
                fill="#FFDAB9"
              />
              <path
                d="M216.428 106.469L227.377 107.725C234.216 108.51 239.318 114.395 239.125 121.276L238.905 129.096C238.724 135.539 233.937 140.919 227.559 141.849L216.428 143.471V106.469Z"
                fill="#FFDAB9"
              />
              <path
                d="M23.0391 106.469L12.0897 107.725C5.25083 108.51 0.14846 114.395 0.34186 121.276L0.561621 129.096C0.742718 135.539 5.52967 140.919 11.9082 141.849L23.0391 143.471V106.469Z"
                fill="#FFDAB9"
              />
              <path
                d="M216.428 113.453L221.716 114.019C227.399 114.628 231.654 119.51 231.482 125.222C231.322 130.565 227.322 135.009 222.026 135.73L216.428 136.492V113.453Z"
                fill="#F9C69F"
              />
              <path
                d="M23.0391 113.453L17.7506 114.019C12.068 114.628 7.81242 119.51 7.98433 125.222C8.14511 130.565 12.1443 135.009 17.4406 135.73L23.0391 136.492V113.453Z"
                fill="#F9C69F"
              />
              <path
                d="M118.884 131.57C119.074 131.718 119.341 131.718 119.531 131.57L122.557 129.211C122.952 128.903 122.734 128.27 122.233 128.27H116.181C115.681 128.27 115.463 128.903 115.858 129.211L118.884 131.57Z"
                fill="#F4A261"
              />
              <path
                d="M112.713 133.401H125.701V136.184C125.701 139.77 122.794 142.678 119.207 142.678C115.62 142.678 112.713 139.77 112.713 136.184V133.401Z"
                fill="#2A2A2A"
              />
              <path
                d="M116.424 139.895C116.424 138.358 117.67 137.112 119.207 137.112H125.701V138.04C125.701 140.601 123.624 142.678 121.062 142.678H119.207C117.67 142.678 116.424 141.432 116.424 139.895Z"
                fill="#EA6868"
              />
              <g filter="url(#filter0_d_227_3591)">
                <path
                  d="M120.272 59.099C114.573 74.132 99.6154 102.146 85.3791 93.9393C89.9152 85.8099 99.0571 67.4607 99.3362 59.099C94.3349 73.0351 77.1444 99.9318 48.3928 96.0297C51.492 89.2675 58.5336 74.4741 62.2056 68.7296C52.7026 83.4384 30.5267 112.76 16.6403 114.147C9.19655 81.6291 18.7339 15.479 116.434 11.0195C214.133 6.55993 228.323 77.9128 223.206 114.147C214.831 110.198 193.896 95.5419 177.147 68.5059L190.755 95.6814C179.124 97.8879 152.722 93.6605 140.161 59.099C142.138 67.8091 147.698 87.1803 154.118 94.9846C146.209 96.4943 128.367 91.4307 120.272 59.099Z"
                  fill="#A98668"
                />
              </g>
              <path
                d="M113.45 11.5195C113.218 9.30872 111.007 3.35114 104.025 0C108.851 0.574462 118.509 3.48588 119.021 10.5489C118.975 9.02598 119.466 5.93956 121.828 3.83985C122.294 5.35252 122.945 8.86656 121.828 10.8214C120.711 12.7762 115.778 12.3341 113.45 11.5195Z"
                fill="#A98668"
              />
              <path
                d="M160.088 105C151.242 105.585 144.27 112.174 144.27 120.217C144.27 128.645 151.926 135.477 161.371 135.477C164.13 135.477 166.736 134.893 169.043 133.857C172.538 130.883 174.789 126.378 174.789 121.272C174.789 112.545 168.213 105.574 160.088 105Z"
                fill="white"
              />
              <ellipse
                cx="18.1543"
                cy="18.4174"
                rx="18.1543"
                ry="18.4174"
                transform="matrix(-1 0 0 1 175.314 103.904)"
                fill="white"
              />
              <circle
                cx="1.84174"
                cy="1.84174"
                r="1.84174"
                transform="matrix(-1 0 0 1 165.316 119.164)"
                fill="white"
              />
              <ellipse
                cx="6.31452"
                cy="5.78831"
                rx="6.31452"
                ry="5.78831"
                transform="matrix(-1 0 0 1 156.371 108.115)"
                fill="white"
              />
              <path
                d="M161.673 106.371C157.236 106.371 152.554 109.337 150.127 114.437C149.694 116.194 149.499 118.143 149.499 120.221C149.499 128.648 157.156 135.48 166.601 135.48C167.424 135.48 168.234 135.426 169.026 135.326C172.403 132.639 174.9 128.09 174.9 122.214C174.9 112.469 168.035 106.371 161.673 106.371Z"
                fill="url(#paint0_linear_227_3591)"
              />
              <path
                d="M157.16 104.666C147.565 104.666 139.768 112.56 139.768 122.321C139.768 132.082 147.565 139.977 157.16 139.977C166.756 139.977 174.553 132.082 174.553 122.321C174.553 112.56 166.756 104.666 157.16 104.666Z"
                stroke="#2A2A2A"
                stroke-width="1.52271"
              />
              <circle
                cx="1.84174"
                cy="1.84174"
                r="1.84174"
                transform="matrix(-1 0 0 1 170.547 119.164)"
                fill="white"
              />
              <ellipse
                cx="6.05142"
                cy="5.78831"
                rx="6.05142"
                ry="5.78831"
                transform="matrix(-1 0 0 1 162.654 108.642)"
                fill="white"
              />
              <path
                d="M179.25 131.161C172.571 129.676 151.109 134.253 141.213 136.727C128.596 150.086 164.407 152.189 183.889 151.571C185.126 145.386 185.93 132.645 179.25 131.161Z"
                fill="#FFDAB9"
              />
              <path
                d="M84.0166 105C75.1705 105.585 68.1973 112.174 68.1973 120.217C68.1973 128.645 75.8537 135.477 85.2988 135.477C88.0576 135.477 90.6633 134.893 92.9707 133.857C96.4654 130.883 98.7167 126.378 98.7168 121.272C98.7168 112.545 92.1408 105.575 84.0166 105Z"
                fill="white"
              />
              <ellipse
                cx="18.1543"
                cy="18.4174"
                rx="18.1543"
                ry="18.4174"
                transform="matrix(-1 0 0 1 99.2422 103.904)"
                fill="white"
              />
              <circle
                cx="1.84174"
                cy="1.84174"
                r="1.84174"
                transform="matrix(-1 0 0 1 89.2441 119.164)"
                fill="white"
              />
              <ellipse
                cx="6.31452"
                cy="5.78831"
                rx="6.31452"
                ry="5.78831"
                transform="matrix(-1 0 0 1 80.2988 108.115)"
                fill="white"
              />
              <path
                d="M85.6006 106.371C81.1644 106.371 76.4834 109.335 74.0557 114.433C73.6219 116.191 73.4268 118.141 73.4268 120.221C73.427 128.648 81.0835 135.48 90.5283 135.48C91.3518 135.48 92.1617 135.426 92.9541 135.326C96.331 132.639 98.8281 128.09 98.8281 122.214C98.8279 112.469 91.963 106.371 85.6006 106.371Z"
                fill="url(#paint1_linear_227_3591)"
              />
              <path
                d="M81.0879 104.666C71.4925 104.666 63.6955 112.56 63.6953 122.321C63.6953 132.082 71.4924 139.977 81.0879 139.977C90.6834 139.977 98.4805 132.082 98.4805 122.321C98.4803 112.56 90.6833 104.666 81.0879 104.666Z"
                stroke="#2A2A2A"
                stroke-width="1.52271"
              />
              <circle
                cx="1.84174"
                cy="1.84174"
                r="1.84174"
                transform="matrix(-1 0 0 1 94.4746 119.164)"
                fill="white"
              />
              <ellipse
                cx="6.05142"
                cy="5.78831"
                rx="6.05142"
                ry="5.78831"
                transform="matrix(-1 0 0 1 86.582 108.642)"
                fill="white"
              />
              <path
                d="M64.1462 131.161C70.8259 129.676 92.2873 134.253 102.183 136.727C114.8 150.086 78.9899 152.189 59.5076 151.571C58.2706 145.386 57.4666 132.645 64.1462 131.161Z"
                fill="#FFDAB9"
              />
              <circle cx="182.352" cy="132.349" r="1.57863" fill="#F4A261" />
              <circle cx="176.827" cy="140.504" r="1.31553" fill="#F4A261" />
              <path
                d="M184.457 141.029C184.457 141.756 183.868 142.345 183.142 142.345C182.415 142.345 181.826 141.756 181.826 141.029C181.563 140.24 182.415 139.451 183.142 139.451C183.868 139.451 184.457 140.303 184.457 141.029Z"
                fill="#F4A261"
              />
              <path
                d="M189.72 139.328C189.72 140.142 188.663 141.293 187.916 141.293C187.168 141.293 186.562 140.142 186.562 139.328C186.562 138.515 187.168 137.609 187.916 137.609C188.663 137.609 189.72 138.515 189.72 139.328Z"
                fill="#F4A261"
              />
              <path
                d="M192.351 132.349C192.351 133.221 191.118 134.191 190.246 134.191C189.374 134.191 189.193 133.221 189.193 132.349C189.193 131.477 189.9 130.771 190.772 130.771C191.644 130.771 192.351 131.477 192.351 132.349Z"
                fill="#F4A261"
              />
              <circle
                cx="1.57863"
                cy="1.57863"
                r="1.57863"
                transform="matrix(-1 0 0 1 58.6934 130.771)"
                fill="#F4A261"
              />
              <circle
                cx="1.31553"
                cy="1.31553"
                r="1.31553"
                transform="matrix(-1 0 0 1 63.9551 139.188)"
                fill="#F4A261"
              />
              <path
                d="M55.0096 141.029C55.0096 141.756 55.5986 142.345 56.3251 142.345C57.0516 142.345 57.6406 141.756 57.6406 141.029C57.9037 140.24 57.0516 139.451 56.3251 139.451C55.5986 139.451 55.0096 140.303 55.0096 141.029Z"
                fill="#F4A261"
              />
              <path
                d="M49.747 139.328C49.747 140.142 50.8039 141.293 51.5512 141.293C52.2985 141.293 52.9043 140.142 52.9043 139.328C52.9043 138.515 52.2985 137.609 51.5512 137.609C50.8039 137.609 49.747 138.515 49.747 139.328Z"
                fill="#F4A261"
              />
              <path
                d="M47.1162 132.349C47.1162 133.221 48.3492 134.191 49.221 134.191C50.0929 134.191 50.2734 133.221 50.2734 132.349C50.2734 131.477 49.5667 130.771 48.6948 130.771C47.823 130.771 47.1162 131.477 47.1162 132.349Z"
                fill="#F4A261"
              />
              <path
                d="M186.5 209C174.1 177 146.334 170 134 170.5L116 173.5C72.5003 163.5 54.5003 209 55.5003 209C56.3003 209 65.5003 214.333 70.0003 217V270.5H171V217L186.5 209Z"
                fill="#3978DF"
                stroke="#1A71FF"
                stroke-width="0.3"
              />
              <path
                d="M169.519 216.637C169.569 216.753 169.654 216.853 169.767 216.912C169.88 216.971 170.009 216.986 170.129 216.952C170.249 216.917 170.351 216.837 170.416 216.727C170.48 216.617 170.5 216.487 170.481 216.363C170.441 216.102 170.394 215.827 170.346 215.562C169.905 213.156 169.244 210.809 168.32 208.538C167.32 206.305 166.434 203.96 164.077 202.273C163.781 202.11 163.421 201.969 163 202C162.875 202.016 162.756 202.071 162.668 202.163C162.58 202.255 162.53 202.375 162.53 202.5C162.53 202.625 162.58 202.745 162.668 202.837C162.756 202.929 162.875 202.984 163 203C163.121 203.033 163.26 203.12 163.409 203.258C164.748 204.74 165.554 207.169 166.469 209.295C167.36 211.484 168.259 213.689 169.206 215.903C169.31 216.146 169.416 216.399 169.519 216.637Z"
                fill="#2561C0"
              />
              <path
                d="M71.512 216.068C71.4627 216.183 71.3771 216.283 71.2643 216.342C71.1515 216.402 71.0221 216.416 70.9022 216.382C70.7823 216.348 70.6801 216.267 70.6157 216.157C70.5513 216.047 70.5313 215.917 70.5505 215.793C70.5903 215.532 70.6377 215.257 70.6854 214.993C71.1265 212.586 71.7869 210.239 72.7114 207.968C73.7111 205.735 74.5968 203.39 76.9542 201.704C77.2505 201.54 77.6106 201.399 78.0312 201.43C78.1559 201.446 78.2753 201.501 78.3635 201.593C78.4516 201.685 78.5011 201.806 78.5011 201.93C78.5011 202.055 78.4516 202.175 78.3635 202.267C78.2753 202.36 78.1559 202.415 78.0312 202.43C77.9107 202.463 77.7716 202.551 77.6222 202.689C76.2833 204.17 75.4771 206.599 74.5626 208.725C73.6714 210.914 72.7726 213.12 71.8257 215.333C71.7217 215.577 71.6148 215.829 71.512 216.068Z"
                fill="#2561C0"
              />
              <g filter="url(#filter1_d_227_3591)">
                <path
                  d="M174.501 242.5C177.044 242.882 178.467 242.881 181.001 242.5C197.433 239.195 190.465 219.319 185.049 210.082L185.001 210L173.001 216.5L152.501 209.5C151.62 208.323 150.001 205.5 149.501 204.5C149.001 203.5 148.667 197.5 149.001 194C143.801 190 141.501 195.333 141.001 198.5V207C126.201 203.4 126.834 209.5 129.001 213C124.601 216.2 126.834 219.333 128.501 220.5C125.301 223.3 127.501 226.666 129.001 228C124.001 237 147.001 234 147.501 233.5C147.901 233.1 148.667 233.333 149.001 233.5C156.601 237.5 169.167 241.166 174.501 242.5Z"
                  fill="#FFDAB9"
                />
                <path
                  d="M185.001 210L173.001 216.5L152.501 209.5C151.62 208.323 150.001 205.5 149.501 204.5C149.001 203.5 148.667 197.5 149.001 194C143.801 190 141.501 195.333 141.001 198.5V207C126.201 203.4 126.834 209.5 129.001 213C124.601 216.2 126.834 219.333 128.501 220.5C125.301 223.3 127.501 226.666 129.001 228C124.001 237 147.001 234 147.501 233.5C147.901 233.1 148.667 233.333 149.001 233.5C156.601 237.5 169.167 241.166 174.501 242.5C177.044 242.882 178.467 242.881 181.001 242.5C197.433 239.195 190.465 219.319 185.049 210.082M185.001 210C185.017 210.027 185.033 210.054 185.049 210.082M185.001 210L185.049 210.082"
                  stroke="#FFDAB9"
                />
              </g>
              <g filter="url(#filter2_d_227_3591)">
                <path
                  d="M66.5305 241.93C63.9908 242.304 62.5698 242.343 60.0305 241.93C43.9284 239.308 50.6279 218.888 55.9821 209.512L56.0305 209.43L68.0305 215.93L88.5305 208.93C89.4117 207.753 91.0305 204.93 91.5305 203.93C92.0305 202.93 92.3639 196.93 92.0305 193.43C97.2305 189.43 99.5305 194.763 100.031 197.93V206.43C114.831 202.83 114.197 208.93 112.031 212.43C116.431 215.63 114.197 218.763 112.531 219.93C115.731 222.73 113.531 226.097 112.031 227.43C117.031 236.43 94.0305 233.43 93.5305 232.93C93.1305 232.53 92.3639 232.763 92.0305 232.93C84.4305 236.93 71.8639 240.597 66.5305 241.93Z"
                  fill="#FFDAB9"
                />
                <path
                  d="M56.0305 209.43L68.0305 215.93L88.5305 208.93C89.4117 207.753 91.0305 204.93 91.5305 203.93C92.0305 202.93 92.3639 196.93 92.0305 193.43C97.2305 189.43 99.5305 194.763 100.031 197.93V206.43C114.831 202.83 114.197 208.93 112.031 212.43C116.431 215.63 114.197 218.763 112.531 219.93C115.731 222.73 113.531 226.097 112.031 227.43C117.031 236.43 94.0305 233.43 93.5305 232.93C93.1305 232.53 92.3639 232.763 92.0305 232.93C84.4305 236.93 71.8639 240.597 66.5305 241.93C63.9908 242.304 62.5698 242.343 60.0305 241.93C43.9284 239.308 50.6279 218.888 55.9821 209.512M56.0305 209.43C56.0144 209.457 55.9982 209.485 55.9821 209.512M56.0305 209.43L55.9821 209.512"
                  stroke="#FFDAB9"
                />
              </g>
              <path
                d="M186.395 211.325L185.1 209.166C185.044 209.074 184.925 209.042 184.831 209.095L172.913 215.769C172.759 215.855 172.784 216.084 172.954 216.135L181.929 218.8C182.122 218.858 182.27 218.626 182.136 218.476L179.655 215.684C179.57 215.589 179.595 215.441 179.705 215.378L186.322 211.601C186.42 211.546 186.453 211.421 186.395 211.325Z"
                fill="#EEC9A9"
              />
              <path
                d="M54.5663 210.834L55.4168 208.708C55.4611 208.597 55.5921 208.55 55.6973 208.606L68.0361 215.25C68.1981 215.337 68.1662 215.579 67.9871 215.621L58.5137 217.855C58.3236 217.9 58.1885 217.673 58.3183 217.527L60.8411 214.689C60.9269 214.593 60.9001 214.441 60.7863 214.38L54.6573 211.085C54.5677 211.036 54.5286 210.929 54.5663 210.834Z"
                fill="#EEC9A9"
              />
              <path
                d="M107.5 171L135.5 171.5C135.5 171.5 135.015 184 120.515 184C106.015 184 107.5 171 107.5 171Z"
                fill="#FFDAB9"
                stroke="#FFDAB9"
              />
              <rect x="107" y="167" width="29" height="6" fill="#FFDAB9" />
              <rect
                x="107"
                y="168"
                width="29"
                height="4"
                fill="#A98668"
                fill-opacity="0.2"
              />
              <defs>
                <filter
                  id="filter0_d_227_3591"
                  x="14.6621"
                  y="10.8198"
                  width="209.445"
                  height="106.119"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    result="hardAlpha"
                  />
                  <feOffset dy="2.79262" />
                  <feComposite in2="hardAlpha" operator="out" />
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 0.976471 0 0 0 0 0.780392 0 0 0 0 0.619608 0 0 0 1 0"
                  />
                  <feBlend
                    mode="normal"
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow_227_3591"
                  />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="effect1_dropShadow_227_3591"
                    result="shape"
                  />
                </filter>
                <filter
                  id="filter1_d_227_3591"
                  x="125.932"
                  y="192.07"
                  width="65.8223"
                  height="53.2163"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    result="hardAlpha"
                  />
                  <feOffset dy="2" />
                  <feComposite in2="hardAlpha" operator="out" />
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
                  />
                  <feBlend
                    mode="normal"
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow_227_3591"
                  />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="effect1_dropShadow_227_3591"
                    result="shape"
                  />
                </filter>
                <filter
                  id="filter2_d_227_3591"
                  x="49.4297"
                  y="191.5"
                  width="65.6699"
                  height="53.2255"
                  filterUnits="userSpaceOnUse"
                  color-interpolation-filters="sRGB"
                >
                  <feFlood flood-opacity="0" result="BackgroundImageFix" />
                  <feColorMatrix
                    in="SourceAlpha"
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    result="hardAlpha"
                  />
                  <feOffset dy="2" />
                  <feComposite in2="hardAlpha" operator="out" />
                  <feColorMatrix
                    type="matrix"
                    values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"
                  />
                  <feBlend
                    mode="normal"
                    in2="BackgroundImageFix"
                    result="effect1_dropShadow_227_3591"
                  />
                  <feBlend
                    mode="normal"
                    in="SourceGraphic"
                    in2="effect1_dropShadow_227_3591"
                    result="shape"
                  />
                </filter>
                <linearGradient
                  id="paint0_linear_227_3591"
                  x1="159.528"
                  y1="105.485"
                  x2="159.528"
                  y2="135.48"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="#2A2A2A" />
                  <stop offset="1" stop-color="#666666" />
                </linearGradient>
                <linearGradient
                  id="paint1_linear_227_3591"
                  x1="83.4562"
                  y1="105.485"
                  x2="83.4562"
                  y2="135.48"
                  gradientUnits="userSpaceOnUse"
                >
                  <stop stop-color="#2A2A2A" />
                  <stop offset="1" stop-color="#666666" />
                </linearGradient>
              </defs>
            </svg>
          ) : (
            "ğŸ˜Ÿ"
          )}
        </span>
      </div>

      <div className="flex flex-col gap-4 w-full max-w-sm">
        {type === "success" ? (
          // Ù‡Ù†Ø§ ÙŠØªÙ… ÙØ­Øµ Ù‡Ù„ ÙˆØµÙ„Ù†Ø§ Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3 Ø£Ù… Ù„Ø§
          currentLevel < 3 ? (
            <button
              onClick={onNext}
              className="bg-[#488DFF] text-white py-5 mt-10 rounded-[25px] text-2xl font-black  active:translate-y-1 transition-all"
            >
              Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ
            </button>
          ) : (
            <button
              onClick={() => (window.location.href = "/")}
              className="bg-green-500 text-white py-5 rounded-[25px] text-2xl font-black shadow-[0_8px_0_0_#2d6a4f] active:translate-y-1 transition-all"
            >
              ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª ğŸ‰
            </button>
          )
        ) : (
          <button
            onClick={onRetry}
            className="bg-red-500 text-white py-5 rounded-[25px] text-2xl font-black shadow-[0_8px_0_0_#cc4444] active:translate-y-1 transition-all"
          >
            Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
          </button>
        )}
      </div>
    </div>
  );
};

export default BalloonGame;
